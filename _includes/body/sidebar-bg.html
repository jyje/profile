{% assign image       = include.image       %}
{% assign color       = include.color       %}
{% assign theme_color = include.theme_color %}

{% if image.background %}
  {% comment %} Support dim overlay by prepending gradient to background {% endcomment %}
  {% if image.dim %}
    {% assign dim_value = image.dim | times: 1.0 | divided_by: 100.0 %}
    {% capture bg_style %}background:linear-gradient(rgba(0,0,0,{{ dim_value }}),rgba(0,0,0,{{ dim_value }})),{{ image.background }}{% endcapture %}
  {% else %}
    {% capture bg_style %}background:{{ image.background }}{% endcapture %}
  {% endif %}
  {% capture bg_class %}sidebar-bg {% if image.overlay %}sidebar-overlay{% endif %}{% endcapture %}
  {% comment %} Support blur filter - wrap in container with overflow:hidden {% endcomment %}
  {% if image.blur %}
    {% assign blur_value = image.blur | append: "" %}
    {% unless blur_value contains "px" %}
      {% assign blur_value = blur_value | append: "px" %}
    {% endunless %}
    {% assign use_blur_wrapper = true %}
    {% capture blur_style %}filter:blur({{ blur_value }});transform:scale(1.1);position:absolute;top:0;left:0;width:100%;height:100%{% endcapture %}
  {% else %}
    {% assign use_blur_wrapper = false %}
  {% endif %}
{% else %}
  {% assign bg_color = theme_color | default:site.theme_color | default:color %}
  {% capture bg_style %}background-color:{{ bg_color }};{% if image != 'none' %}background-image:url({% include_cached smart-url url=image %}){% endif %}{% endcapture %}
  {% capture bg_class %}sidebar-bg {% if image != 'none' %}sidebar-overlay{% endif %}{% endcapture %}
  {% assign use_blur_wrapper = false %}
{% endif %}
{% if use_blur_wrapper %}
<div class="{{ bg_class }}" style="overflow:hidden">
  <div style="{{ bg_style }};{{ blur_style }}"></div>
</div>
{% else %}
<div class="{{ bg_class }}" style="{{ bg_style }}"></div>
{% endif %}
