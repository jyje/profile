<span class="sr-only">{{ site.data.strings.navigation | default:"Navigation" }}{{ site.data.strings.colon | default:":" }}</span>
<ul>
  {% comment %}Language detection - use passed lang or detect from URL{% endcomment %}
  {% assign current_lang = include.lang | default:'en' %}
  {% if current_lang == blank or current_lang == '' %}
    {% if page.url contains '/ko/' or page.url == '/ko' or page.url == '/ko/' %}
      {% assign current_lang = 'ko' %}
    {% else %}
      {% assign current_lang = 'en' %}
    {% endif %}
  {% endif %}

  {% comment %}Home menu with language-specific URL and title (controlled by sidebar_show_home in _config.yml){% endcomment %}
  {% if site.sidebar_show_home != false %}
  <li>
    <a
      href="{% if current_lang == 'ko' %}{{ '/ko/' | relative_url }}{% else %}{{ '/' | relative_url }}{% endif %}"
      class="sidebar-nav-item"
    >
      {% if current_lang == 'ko' %}Home{% else %}Home{% endif %}
    </a>
  </li>
  {% endif %}

  {% comment %}Select menu items based on language{% endcomment %}
  {% if current_lang == 'ko' %}
    {% assign menu_items = site.menu_ko %}
  {% else %}
    {% assign menu_items = site.menu_en %}
  {% endif %}

  {% for node in menu_items %}
    {% assign url = node.url | default: node.href %}
    {% comment %}Convert URL based on current language{% endcomment %}
    {% if current_lang == 'ko' %}
      {% comment %}Ensure Korean URLs are used{% endcomment %}
      {% if url contains '/en/' %}
        {% assign url = url | replace: '/en/', '/ko/' %}
      {% endif %}
    {% else %}
      {% comment %}Ensure English URLs are used{% endcomment %}
      {% if url contains '/ko/' %}
        {% assign url = url | replace: '/ko/', '/en/' %}
      {% endif %}
    {% endif %}
    <li>
      <a
        href="{% include smart-url url=url %}"
        class="sidebar-nav-item {% if node.external %}external{% endif %}"
        {% if node.rel %}rel="{{ node.rel }}"{% endif %}
      >
        {{ node.name | default:node.title }}
      </a>
    </li>
  {% endfor %}
</ul>
