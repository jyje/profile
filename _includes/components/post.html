{% assign post             = include.post             %}
{% assign no_link_title    = include.no_link_title    %}
{% assign no_excerpt       = include.no_excerpt       %}
{% assign hide_image       = include.hide_image       %}
{% assign hide_description = include.hide_description %}

<article id="post{{ post.id | replace:'/','-' }}" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      {% unless no_link_title %}<a href="{{ post.url | relative_url }}" class="flip-title">{% endunless %}
        {{ post.title }}
      {% unless no_link_title %}</a>{% endunless %}
    </h1>

    <div class="post-date">
      {%- assign created_label = site.data.strings.created_at | default:"Created" -%}
      {%- assign updated_label = site.data.strings.updated_at | default:"Updated" -%}
      {%- assign created_at = post.created_at -%}
      {%- assign updated_at = post.updated_at -%}
      {% capture foobar %}
        {%- unless site.hydejack.hide_dates -%}
          {%- assign post_format = site.data.strings.date_formats.post | default:"%d %b %Y" -%}
          <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date:post_format }}</time>
        {%- else -%}
          {{- site.data.strings.posted | default:"Posted" -}}
        {%- endunless -%}
        {{ ' ' }}
        {%- assign category_start     = site.data.strings.category_start     | default:"in " -%}
        {%- assign category_separator = site.data.strings.category_separator | default:" / " -%}
        {%- comment -%}Determine language from post path and display flag{%- endcomment -%}
        {%- assign lang_flag = "" -%}
        {%- if post.path contains 'en/' -%}
          {%- assign lang_flag = "ðŸ‡¬ðŸ‡§ " -%}
        {%- elsif post.path contains 'ko/' -%}
          {%- assign lang_flag = "ðŸ‡°ðŸ‡· " -%}
        {%- endif -%}
        {%- comment -%}Filter out language categories (En, Ko) from categories{%- endcomment -%}
        {%- assign filtered_categories = "" | split: "," -%}
        {%- for cat in post.categories -%}
          {%- assign cat_lower = cat | downcase -%}
          {%- unless cat_lower == "en" or cat_lower == "ko" -%}
            {%- assign filtered_categories = filtered_categories | push: cat -%}
          {%- endunless -%}
        {%- endfor -%}
        {%- assign category_start_with_flag = category_start | append: lang_flag -%}
        {%- include components/tag-list.html tags=filtered_categories meta=site.featured_categories start_with=category_start_with_flag separator=category_separator -%}
        {{ ' ' }}
        {%- assign tag_start          = site.data.strings.tag_start          | default:"on " -%}
        {%- assign tag_separator      = site.data.strings.tag_separator      | default:", "  -%}
        {%- include components/tag-list.html tags=post.tags meta=site.featured_tags start_with=tag_start separator=tag_separator -%}
        {%- comment -%}Git dates (hidden, shown only in click tooltip){%- endcomment -%}
        {%- if created_at or updated_at -%}
          <span class="sr-only"><br/>
          {%- if created_at -%}
            {{ created_label }}{{ site.data.strings.colon }} {{ created_at | date:"%Y-%m-%d" }}
          {%- endif -%}
          {%- if created_at and updated_at -%} | {% endif -%}
          {%- if updated_at -%}
            {{ updated_label }}{{ site.data.strings.colon }} {{ updated_at | date:"%Y-%m-%d" }}
          {%- endif -%}
          </span>
        {%- endif -%}
      {% endcapture %}
      <span class="ellipsis mr1">
        {{ foobar }}
      </span>
      {% unless site.hydejack.hide_dates or site.hydejack.hide_last_modified or post.hide_last_modified %}
        {% if post.last_modified_at %}
          {% assign d1 = post.date             | date:"%Y-%m-%d" %}
          {% assign d2 = post.last_modified_at | date:"%Y-%m-%d" %}
          {% if d1 != d2 %}
            {% assign label = site.data.strings.last_modified_at | default:"Last modified at" %}
            {% assign last_modified_at_format = site.data.strings.date_formats.last_modified_at | default:"%Y-%m-%d" %}
            <span class="ellipsis" data-tippy-content="{{ label }}{{ site.data.strings.colon }} {{ post.last_modified_at | date:post_format }}">
              <span class="sr-only">{{ label }}{{ site.data.strings.colon }}</span>
              <span class="{{ site.data.strings.last_modified_icon | default:'icon-history' }}"></span>
              <time datetime="{{ post.last_modified_at | date_to_xmlschema }}">{{ post.last_modified_at | date:last_modified_at_format }}</time>
            </span>
          {% endif %}
        {% endif %}
      {% endunless %}
    </div>

    {% assign alt = false %}
    {% unless hide_image %}{% if post.image %}
      {% comment %} Support both string and object formats for image {% endcomment %}
      {% if post.image.path %}
        {% assign img_path = post.image.path %}
        {% assign img_width = post.image.width | default: 864 %}
        {% assign img_height = post.image.height | default: 486 %}
        {% comment %} left, top for object-position (optional, supports px and %) {% endcomment %}
        {% if post.image.left != nil or post.image.top != nil %}
          {% assign img_left = post.image.left | default: "50%" %}
          {% assign img_top = post.image.top | default: "50%" %}
          {% comment %} Add % suffix if value is a number without unit {% endcomment %}
          {% assign left_str = img_left | append: "" %}
          {% assign top_str = img_top | append: "" %}
          {% unless left_str contains "%" or left_str contains "px" %}
            {% assign left_str = left_str | append: "%" %}
          {% endunless %}
          {% unless top_str contains "%" or top_str contains "px" %}
            {% assign top_str = top_str | append: "%" %}
          {% endunless %}
          {% capture img_position %}{{ left_str }} {{ top_str }}{% endcapture %}
        {% else %}
          {% assign img_position = nil %}
        {% endif %}
      {% else %}
        {% assign img_path = post.image %}
        {% assign img_width = 864 %}
        {% assign img_height = 486 %}
        {% assign img_position = nil %}
      {% endif %}
      {% comment %} Calculate container style for custom aspect ratio {% endcomment %}
      {% if post.image.path %}
        {% capture container_style %}aspect-ratio: {{ img_width }} / {{ img_height }}; overflow: hidden;{% endcapture %}
      {% else %}
        {% assign container_style = nil %}
      {% endif %}
      {% unless no_link_title %}<a href="{{ post.url | relative_url }}" class="no-hover no-print-link {% unless post.hide_image %}flip-project{% endunless %}" tabindex="-1">{% endunless %}
        <div class="img-wrapper lead aspect-ratio flip-project-img" {% if container_style %}style="{{ container_style }}"{% endif %}>
          {% include_cached components/hy-img.html img=img_path alt=post.title width=img_width height=img_height position=img_position %}
        </div>
      {% unless no_link_title %}</a>{% endunless %}
      {% assign alt = '' %}
    {% endif %}{% endunless %}

    {% include components/message.html text=post.description hide=hide_description alt=alt %}
  </header>

  {% if no_excerpt %}
    {{ post.content }}
  {% else %}
    {{ post.excerpt }}

    {% capture post_title %}<a class="heading flip-title" href="{{ post.url | relative_url }}">{{ post.title }}</a>{% endcapture %}
    {% assign text = site.data.strings.continue_reading | default:"Continue reading <!--post_title-->" %}
    <footer>
      <p class="read-more">
        {{ text | replace:"<!--post_title-->", post_title }}
      </p>
    </footer>
  {% endif %}
</article>
